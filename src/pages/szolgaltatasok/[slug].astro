---
import { getCollection } from 'astro:content';
import BaseLayout from "@/layouts/BaseLayout.astro";
import Navbar from "@/components/Navbar.astro";
import Footer from "@/components/Footer.astro";
import ServiceSidebar from "@/components/service/ServiceSidebar.astro";
import { Search, Brain, BarChart3, Globe, Zap, Target, ChevronRight } from "lucide-react";

export async function getStaticPaths() {
  const services = await getCollection('services');
  return services.map(service => ({
    params: { slug: service.id.replace(/\.mdx?$/, '') },
    props: { service },
  }));
}

const { service } = Astro.props;
const { Content } = await service.render();
const { title, longDescription, icon, accentColor } = service.data;

const iconMap: Record<string, any> = {
  Search, Brain, BarChart3, Globe, Zap, Target,
};
const IconComponent = iconMap[icon];

const colorMap: Record<string, { bg: string; text: string }> = {
  blue:   { bg: "bg-blue-100",   text: "text-blue-600" },
  indigo: { bg: "bg-indigo-100", text: "text-indigo-600" },
  teal:   { bg: "bg-teal-100",   text: "text-teal-600" },
  purple: { bg: "bg-purple-100", text: "text-purple-600" },
  orange: { bg: "bg-orange-100", text: "text-orange-600" },
  pink:   { bg: "bg-pink-100",   text: "text-pink-600" },
};
const colors = colorMap[accentColor] ?? colorMap.blue;

const schema = {
  "@context": "https://schema.org",
  "@type": "Service",
  "name": title,
  "description": longDescription,
  "provider": {
    "@type": "Organization",
    "name": "KeresoPartner",
    "url": "https://keresopartner.hu"
  }
};
---

<BaseLayout title={`${title} – KeresoPartner`} description={longDescription} schema={schema}>
  <Navbar />

  <div class="min-h-screen bg-[hsl(var(--background))]">
    <!-- Hero -->
    <header class="relative overflow-hidden border-b border-[hsl(var(--border))] article-gradient pt-28 pb-16">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Breadcrumb -->
        <nav class="mb-8 flex items-center gap-1 text-sm text-slate-400">
          <a href="/#szolgaltatasok" class="transition-colors hover:text-[hsl(var(--primary))]">Szolgáltatások</a>
          <ChevronRight size={14} />
          <span class="text-slate-600">{title}</span>
        </nav>

        <div class="max-w-3xl">
          <div class={`mb-6 flex h-16 w-16 items-center justify-center rounded-2xl ${colors.bg} ${colors.text}`}>
            {IconComponent && <IconComponent size={32} />}
          </div>
          <h1 class="mb-4 font-[var(--font-display)] text-3xl font-bold leading-tight tracking-tight text-slate-900 sm:text-4xl lg:text-5xl">
            {title}
          </h1>
          <p class="text-lg leading-relaxed text-slate-600">
            {longDescription}
          </p>
        </div>
      </div>
    </header>

    <!-- Main content: two-column layout -->
    <main class="py-12">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid lg:grid-cols-12 gap-16">
          <!-- Left column: MDX content -->
          <article class="lg:col-span-8">
            <div class="prose prose-lg text-[hsl(var(--foreground))] prose-headings:font-[var(--font-display)] prose-headings:text-[hsl(var(--foreground))] prose-p:text-[hsl(var(--muted-foreground))] prose-strong:text-[hsl(var(--foreground))] prose-a:text-[hsl(var(--primary))] prose-a:no-underline hover:prose-a:underline prose-blockquote:border-[hsl(var(--primary))] prose-blockquote:text-[hsl(var(--muted-foreground))] prose-li:text-[hsl(var(--muted-foreground))] prose-img:rounded-xl">
              <Content />
            </div>
          </article>

          <!-- Right column: Sidebar -->
          <div class="lg:col-span-4">
            <ServiceSidebar />
          </div>
        </div>
      </div>
    </main>

    <!-- CTA -->
    <section class="border-t border-[hsl(var(--border))] bg-[hsl(var(--card))] py-16">
      <div class="container mx-auto px-4 text-center">
        <h3 class="mb-3 font-[var(--font-display)] text-2xl font-bold text-slate-900">
          Érdekel a {title.toLowerCase()}?
        </h3>
        <p class="mb-6 text-slate-600">
          Kérjen ingyenes konzultációt és személyre szabott ajánlatot!
        </p>
        <a
          href="/#kapcsolat"
          class="inline-flex items-center gap-2 rounded-full bg-[hsl(var(--primary))] px-8 py-3 font-medium text-white shadow-lg shadow-blue-200 transition-all hover:bg-[hsl(var(--primary))]/90 hover:-translate-y-0.5 hover:shadow-blue-300"
        >
          Kapcsolatfelvétel
        </a>
      </div>
    </section>

    <Footer />
  </div>
</BaseLayout>
