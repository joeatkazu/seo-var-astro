---
import { getCollection } from 'astro:content';
import BaseLayout from "@/layouts/BaseLayout.astro";
import Navbar from "@/components/Navbar.astro";
import Footer from "@/components/Footer.astro";
import { Badge } from "@/components/ui/badge";
import { ArrowLeft, Calendar, Clock, User } from "lucide-react";

export async function getStaticPaths() {
  const posts = await getCollection('posts');
  return posts.map(post => ({
    params: { slug: post.id.replace(/\.mdx?$/, '') },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();
const { title, date, author, readTime, coverImage, tags } = post.data;
const slug = post.id.replace(/\.mdx?$/, '');

const schema = {
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": title,
  "image": coverImage,
  "author": {
    "@type": "Person",
    "name": author
  },
  "publisher": {
    "@type": "Organization",
    "name": "KeresoPartner",
    "logo": {
      "@type": "ImageObject",
      "url": "https://keresopartner.hu/favicon.svg"
    }
  },
  "datePublished": date,
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": `https://keresopartner.hu/blog/${slug}`
  },
  "keywords": tags.join(", ")
};
---

<BaseLayout title={`${title} - KeresoPartner Blog`} description={title} schema={schema}>
  <Navbar />

  <div class="min-h-screen bg-[hsl(var(--background))]">
    <!-- Hero -->
    <header class="relative overflow-hidden border-b border-[hsl(var(--border))] bg-[hsl(var(--card))] pt-28 pb-16">
      <div class="container mx-auto px-4">
        <a
          href="/"
          class="mb-8 inline-flex items-center gap-2 text-sm text-[hsl(var(--muted-foreground))] transition-colors hover:text-[hsl(var(--primary))]"
        >
          <ArrowLeft size={16} />
          Vissza a fooldara
        </a>

        <div class="mx-auto max-w-3xl">
          <div class="mb-4 flex flex-wrap gap-2">
            {tags.map((tag: string) => (
              <Badge variant="secondary">
                {tag}
              </Badge>
            ))}
          </div>

          <h1 class="mb-6 font-[var(--font-display)] text-3xl font-bold leading-tight tracking-tight sm:text-4xl lg:text-5xl">
            {title}
          </h1>

          <div class="flex flex-wrap items-center gap-6 text-sm text-[hsl(var(--muted-foreground))]">
            <span class="inline-flex items-center gap-1.5">
              <User size={14} /> {author}
            </span>
            <span class="inline-flex items-center gap-1.5">
              <Calendar size={14} /> {date}
            </span>
            <span class="inline-flex items-center gap-1.5">
              <Clock size={14} /> {readTime}
            </span>
          </div>
        </div>
      </div>
    </header>

    <!-- Cover Image -->
    <div class="container mx-auto px-4">
      <div class="mx-auto -mt-1 max-w-4xl overflow-hidden rounded-b-2xl">
        <img
          src={coverImage}
          alt={title}
          class="aspect-[21/9] w-full object-cover"
          loading="lazy"
        />
      </div>
    </div>

    <!-- Article Body -->
    <article class="container mx-auto px-4 py-16">
      <div class="prose prose-lg mx-auto max-w-3xl text-[hsl(var(--foreground))] prose-headings:font-[var(--font-display)] prose-headings:text-[hsl(var(--foreground))] prose-p:text-[hsl(var(--muted-foreground))] prose-strong:text-[hsl(var(--foreground))] prose-a:text-[hsl(var(--primary))] prose-a:no-underline hover:prose-a:underline prose-blockquote:border-[hsl(var(--primary))] prose-blockquote:text-[hsl(var(--muted-foreground))] prose-code:text-[hsl(var(--primary))] prose-li:text-[hsl(var(--muted-foreground))] prose-img:rounded-xl">
        <Content />
      </div>
    </article>

    <!-- CTA -->
    <section class="border-t border-[hsl(var(--border))] bg-[hsl(var(--card))] py-16">
      <div class="container mx-auto px-4 text-center">
        <h3 class="mb-3 font-[var(--font-display)] text-2xl font-bold">
          Tetszett a cikk?
        </h3>
        <p class="mb-6 text-[hsl(var(--muted-foreground))]">
          Iratkozz fel hirlevelunkre, hogy ne maradj le a kovetkezorol.
        </p>
        <a
          href="/#kapcsolat"
          class="inline-flex items-center gap-2 rounded-lg bg-[hsl(var(--primary))] px-6 py-3 font-medium text-[hsl(var(--primary-foreground))] transition-colors hover:bg-[hsl(var(--primary))]/90"
        >
          Kapcsolatfelvetel
        </a>
      </div>
    </section>

    <Footer />
  </div>
</BaseLayout>
